<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHive Dashboard - Rooms</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="SH-logo.png" alt="StudyHive Logo" class="logo">
        </div>
        <div class="header-center">
            <a href="dashboard-room.html">
                <h1>StudyHive</h1>
            </a>
        </div>
        <nav class="header-right">
            <button id="darkModeToggle">üåô</button>
            <div class="profile-menu">
                <button class="profile-btn">üë§</button>
                <ul class="profile-dropdown">
                    <li><a href="userprofile.html">View Profile</a></li>
                    <li><a href="login.html">Log Out</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Search Bar -->
    <section class="search-section">
        <div class="search-bar">
            <select id="searchType">
                <option value="room">Room</option>
                <option value="user">User</option>
            </select>
            <input type="text" id="searchInput" placeholder="Search StudyHive...">
            <button id="searchBtn">üîç</button>

            <!-- put searchResults here inside the bar wrapper -->
            <ul id="searchResults" class="search-dropdown"></ul>
        </div>
    </section>

    <!-- Main Layout -->
    <div class="main-container">
        <main class="dashboard-layout">
            <!-- Sidebar -->
            <aside class="sidebar">
                <button id="openCreateRoomBtn" class="sidebar-btn">Create Room</button>
                <button class="sidebar-btn">Rooms</button>
                <button class="sidebar-btn" onclick="window.location.href='chat.html'">Chat</button>
            </aside>

            <section class="room-list">
                <div class="room-card" onclick="window.location.href='dashboard-viewroom.html'">
                    <h3>Quantum Mechanics Study</h3>
                    <p>Dive into wave functions and operators together.</p>
                    <span class="capacity">12/30 members</span>
                </div>

                <div class="room-card" onclick="window.location.href='dashboard-viewroom.html'">
                    <h3>Algorithms & Data Structures</h3>
                    <p>Master trees, graphs, and dynamic programming.</p>
                    <span class="capacity">8/20 members</span>
                </div>

                <div class="room-card" onclick="window.location.href='dashboard-viewroom.html'">
                    <h3>Exam Prep Hive</h3>
                    <p>Group revision for upcoming finals. Join in!</p>
                    <span class="capacity">25/50 members</span>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-links">
            <a href="about.html">About</a>
            <a href="about.html">Contact</a>
        </div>
        <p>¬© <span id="year"></span> StudyHive. All rights reserved.</p>
    </footer>

    <!-- Slide-up: User Profile -->
    <div id="userSlideup" class="slideup-panel">
        <div class="slideup-content">
            <button class="close-btn" onclick="closeSlideup('userSlideup')">‚úñ</button>
            <h2 id="userName"></h2>
            <button id="messageUserBtn" class="cta-btn">Message</button>
        </div>
    </div>

    <!-- Slide-up: Room Info -->
    <div id="roomSlideup" class="slideup-panel">
        <div class="slideup-content">
            <button class="close-btn" onclick="closeSlideup('roomSlideup')">‚úñ</button>
            <h2 id="roomName"></h2>
            <p id="roomDescription"></p>
            <p><strong>Capacity:</strong> <span id="roomCapacity"></span></p>
            <p><strong>Created by:</strong> <span id="roomCreator"></span></p>
            <p><strong>Created at:</strong> <span id="roomCreatedAt"></span></p>
            <button id="joinRoomBtn" class="cta-btn">Join Room</button>
            <button id="viewRoomBtn" class="cta-btn">View Room</button>
        </div>
    </div>

    <!-- Slide-up: Create Room -->
    <div id="createRoomSlideup" class="slideup-panel">
        <div class="slideup-content">
            <button class="close-btn" onclick="closeSlideup('createRoomSlideup')">‚úñ</button>
            <h2>Create a New Room</h2>
            <form id="createRoomForm">
                <label for="newRoomName">Room Name</label>
                <input type="text" id="newRoomName" required>

                <label for="newRoomDescription">Room Description</label>
                <textarea id="newRoomDescription" rows="3" required></textarea>

                <label for="newRoomPrivacy">Room Privacy</label>
                <select id="newRoomPrivacy" required>
                    <option value="OPEN">Open</option>
                    <option value="CLOSED">Closed</option>
                    <option value="INVITE_ONLY">Invite Only</option>
                </select>

                <button type="submit" class="cta-btn">Create Room</button>
            </form>
        </div>
    </div>


    <!--    &lt;!&ndash; Search Results Dropdown &ndash;&gt;-->
<!--    <ul id="searchResults" class="search-dropdown"></ul>-->

    <script src="script.js"></script>
    <script src="config.js"></script>
    <script>
        // Dark mode toggle
        const darkToggle = document.getElementById("darkModeToggle");
        darkToggle.addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
            localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
        });
        if (localStorage.getItem("theme") === "dark") {
            document.body.classList.add("dark-mode");
        }

        // Profile dropdown toggle
        document.querySelector(".profile-btn").addEventListener("click", () => {
            document.querySelector(".profile-dropdown").classList.toggle("show");
        });

        // Profile dropdown toggle
        const profileBtn = document.querySelector(".profile-btn");
        const profileDropdown = document.querySelector(".profile-dropdown");

        // Close dropdown if click outside
        document.addEventListener("click", (e) => {
            if (!profileDropdown.contains(e.target) && !profileBtn.contains(e.target)) {
                profileDropdown.classList.remove("show");
            }
        });

        // Dummy data
        const dummyUsers = ["StudyHive_TestUser1", "StudyHive_TestUser2", "StudyHive_TestUser3"];
        const dummyRooms = [
            {
                roomName: "StudyHive_TestRoom1",
                roomDescription: "Room 1 for testing",
                roomCapacity: 30,
                roomCreatedByUserName: "StudyHive_TestUser1",
                roomCreatedAt: new Date().toLocaleString()
            },
            {
                roomName: "StudyHive_TestRoom2",
                roomDescription: "Room 2 for testing",
                roomCapacity: 50,
                roomCreatedByUserName: "StudyHive_TestUser1",
                roomCreatedAt: new Date().toLocaleString()
            },
            {
                roomName: "StudyHive_TestRoom3",
                roomDescription: "Room 3 for testing",
                roomCapacity: 100,
                roomCreatedByUserName: "StudyHive_TestUser1",
                roomCreatedAt: new Date().toLocaleString()
            }
        ];

        const searchInput = document.getElementById("searchInput");
        const searchType = document.getElementById("searchType");
        const searchResults = document.getElementById("searchResults");

        // Handle search input (keyup simulation)
        searchInput.addEventListener("keyup", () => {
            const query = searchInput.value.toLowerCase();
            searchResults.innerHTML = "";

            if (!query) return;

            if (searchType.value === "user") {
                const matches = dummyUsers.filter(u => u.toLowerCase().includes(query));
                matches.forEach(user => {
                    const li = document.createElement("li");
                    li.textContent = user;
                    li.onclick = (e) => {
                        e.stopPropagation(); // Prevent event bubbling
                        showUserSlideup(user);
                    };
                    searchResults.appendChild(li);
                });
            } else if (searchType.value === "room") {
                const matches = dummyRooms.filter(r => r.roomName.toLowerCase().includes(query));
                matches.forEach(room => {
                    const li = document.createElement("li");
                    li.textContent = room.roomName;
                    li.onclick = (e) => {
                        e.stopPropagation(); // Prevent event bubbling
                        showRoomSlideup(room);
                    };
                    searchResults.appendChild(li);
                });
            }
        });

        // User Slideup
        function showUserSlideup(userName) {
            document.getElementById("userName").textContent = userName;
            document.getElementById("userSlideup").classList.add("active");
            searchResults.innerHTML = "";

            // Message button ‚Üí go to chat
            document.getElementById("messageUserBtn").onclick = () => {
                localStorage.setItem("userName", userName);
                window.location.href = "chat.html";
            };
        }

        // Room Slideup
        function showRoomSlideup(room) {
            document.getElementById("roomName").textContent = room.roomName;
            document.getElementById("roomDescription").textContent = room.roomDescription;
            document.getElementById("roomCapacity").textContent = room.roomCapacity;
            document.getElementById("roomCreator").textContent = room.roomCreatedByUserName;
            document.getElementById("roomCreatedAt").textContent = room.roomCreatedAt;

            const joinBtn = document.getElementById("joinRoomBtn");
            const viewBtn = document.getElementById("viewRoomBtn");

            joinBtn.disabled = false;
            viewBtn.disabled = true;

            joinBtn.onclick = () => {
                alert("You have joined " + room.roomName);
                joinBtn.disabled = true;
                viewBtn.disabled = false;
            };

            viewBtn.onclick = () => {
                window.location.href = "dashboard-viewroom.html";
            };

            document.getElementById("roomSlideup").classList.add("active");
            searchResults.innerHTML = "";
        }

        // Close slideup
        function closeSlideup(id) {
            document.getElementById(id).classList.remove("active");
        }

        // Open Create Room Slideup
        document.getElementById("openCreateRoomBtn").onclick = (e) => {
            e.stopPropagation(); // Prevent event bubbling
            document.getElementById("createRoomSlideup").classList.toggle("active");
        };

        // Handle Create Room form submission
        document.getElementById("createRoomForm").addEventListener("submit", (e) => {
            e.preventDefault();

            const name = document.getElementById("newRoomName").value;
            const desc = document.getElementById("newRoomDescription").value;
            const privacy = document.getElementById("newRoomPrivacy").value;

            alert(`Room "${name}" created!\nPrivacy: ${privacy}`);

            // Optionally: reset form & close slideup
            e.target.reset();
            closeSlideup("createRoomSlideup");
        });

        // Replace your existing "Close all slideups when clicking outside" code with this:
        document.addEventListener("click", (e) => {
            // Don't close if clicking on any slideup trigger elements
            if (e.target.closest("#openCreateRoomBtn") ||
                e.target.closest("#searchResults") ||
                e.target.closest(".search-dropdown")) {
                return;
            }

            document.querySelectorAll(".slideup-panel.active").forEach(panel => {
                const content = panel.querySelector(".slideup-content");
                // Close if click is outside the slideup content
                if (!content.contains(e.target)) {
                    panel.classList.remove("active");
                }
            });
        });


    </script>
</body>
</html>
