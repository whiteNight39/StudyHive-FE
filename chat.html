<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHive | Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="SH-logo.png" alt="StudyHive Logo" class="logo">
        </div>
        <div class="header-center">
            <a href="dashboard-room.html">
                <h1>StudyHive</h1>
            </a>
        </div>
        <nav class="header-right">
<!--            <a href="login.html" class="nav-btn">Login</a>-->
            <button id="darkModeToggle">ðŸŒ™</button>
            <div class="profile-menu">
                <button class="profile-btn">ðŸ‘¤</button>
                <ul class="profile-dropdown">
                    <li><a href="userprofile.html">View Profile</a></li>
                    <li><a id= "logOutBtn">Log Out</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Main container (sidebar + chat side by side) -->
    <main class="chat-container">
        <div class="chat-sidebar">
            <ul class="chat-list" id="chatList"></ul>
        </div>

        <div class="chat-box">
            <div class="messages" id="messages"></div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Type a message...">
                <button id="attachBtn">ðŸ“Ž</button>
                <button id="sendBtn">Send</button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p><a href="about.html">About</a> | <a href="about.html">Contact</a></p>
        <p>&copy; 2025 StudyHive. All rights reserved.</p>
    </footer>

<script>

        // Dark mode toggle
        const darkToggle = document.getElementById("darkModeToggle");
        darkToggle.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
    });
        if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
    }

        // Profile dropdown toggle
        document.querySelector(".profile-btn").addEventListener("click", () => {
        document.querySelector(".profile-dropdown").classList.toggle("show");
    });

        // Profile dropdown toggle
        const profileBtn = document.querySelector(".profile-btn");
        const profileDropdown = document.querySelector(".profile-dropdown");

        // Close dropdown if click outside
        document.addEventListener("click", (e) => {
        if (!profileDropdown.contains(e.target) && !profileBtn.contains(e.target)) {
        profileDropdown.classList.remove("show");
    }
    });

    // --- Dummy users (always present) ---
    const dummyUsers = ["Alice", "Bob"];

    // Load existing chats from storage or init with dummy users
    let chats = JSON.parse(localStorage.getItem("chats")) || {};
    dummyUsers.forEach(name => {
        if (!chats[name]) chats[name] = [];
    });

    // Check if we came here via "messageUserBtn"
    const newUser = localStorage.getItem("userName");
    if (newUser) {
        if (!chats[newUser]) chats[newUser] = [];
    }

    // Save updated chats
    localStorage.setItem("chats", JSON.stringify(chats));

    // Populate sidebar
    const chatListEl = document.getElementById("chatList");
    Object.keys(chats).forEach(name => {
        const li = document.createElement("li");
        li.textContent = name;
        li.onclick = () => openChat(name, li);
        chatListEl.appendChild(li);
    });

    // Open chat
    let currentChatUser = newUser || dummyUsers[0];
    if (currentChatUser) {
        document.querySelectorAll("#chatList li").forEach(li => {
            if (li.textContent === currentChatUser) li.classList.add("active");
        });
        renderMessages(currentChatUser);
    }

    function openChat(name, li) {
        currentChatUser = name;
        document.querySelectorAll("#chatList li").forEach(li => li.classList.remove("active"));
        li.classList.add("active");
        renderMessages(name);
    }

    function renderMessages(user) {
        const msgContainer = document.getElementById("messages");
        msgContainer.innerHTML = "";
        chats[user].forEach(msg => {
            const div = document.createElement("div");
            div.className = "message " + (msg.sent ? "sent" : "received");
            div.textContent = msg.text;
            msgContainer.appendChild(div);
        });
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    // Send message
    document.getElementById("sendBtn").onclick = () => {
        const input = document.getElementById("chatInput");
        const text = input.value.trim();
        if (!text) return;
        chats[currentChatUser].push({ text, sent: true });
        localStorage.setItem("chats", JSON.stringify(chats));
        renderMessages(currentChatUser);
        input.value = "";
    };

    function renderMessages(user) {
        const msgContainer = document.getElementById("messages");
        msgContainer.innerHTML = "";
        chats[user].forEach(msg => {
            const div = document.createElement("div");
            div.className = "message " + (msg.sent ? "sent" : "received");

            const bubble = document.createElement("div");
            bubble.className = "bubble";
            bubble.textContent = msg.text;

            const time = document.createElement("span");
            time.className = "timestamp";
            time.textContent = msg.time;

            bubble.appendChild(time);
            div.appendChild(bubble);
            msgContainer.appendChild(div);
        });
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    // Send message
    function sendMessage() {
        const input = document.getElementById("chatInput");
        const text = input.value.trim();
        if (!text) return;
        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        chats[currentChatUser].push({ text, sent: true, time: timeString });
        localStorage.setItem("chats", JSON.stringify(chats));
        renderMessages(currentChatUser);
        input.value = "";
    }

    document.getElementById("sendBtn").onclick = sendMessage;

    // Allow Enter key to send
    document.getElementById("chatInput").addEventListener("keypress", e => {
        if (e.key === "Enter") {
            e.preventDefault();
            sendMessage();
        }
    });

</script>
</body>
</html>
